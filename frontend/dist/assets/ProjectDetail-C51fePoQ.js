import{d as et,m as st,u as ot,r as j,o as at,x as V,y as w,z as l,G as nt,p as y,j as v,b as t,c as g,t as i,B as u,i as T,n as $,F as D,C as E,E as z,k as rt}from"./index-BeQ_YpYi.js";import{_ as lt}from"./MainLayout.vue_vue_type_script_setup_true_lang-BCk_IIN5.js";import{_ as m}from"./Card.vue_vue_type_script_setup_true_lang-pWITqjj4.js";import{_ as H}from"./Button.vue_vue_type_script_setup_true_lang-BNsZ58pO.js";import{_ as dt}from"./ProgressBar.vue_vue_type_script_setup_true_lang-BKkjWedc.js";import{_ as it}from"./ProjectModal.vue_vue_type_script_setup_true_lang-BM0zuTNQ.js";import{u as ut}from"./task-pjRFF-OE.js";import{d as ct}from"./dayjs.min-Do37gnd9.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./Modal-DQYTPExH.js";import"./Input.vue_vue_type_script_setup_true_lang-xq1Wb3QM.js";import"./Select.vue_vue_type_script_setup_true_lang-D-AOEX65.js";import"./_commonjsHelpers-C4iS2aBk.js";const pt={class:"space-y-6"},mt={key:0,class:"flex items-center justify-between"},vt={class:"flex items-center gap-4"},ft={class:"text-2xl font-bold text-secondary-900"},gt={class:"mt-1 text-sm text-secondary-600"},xt={class:"flex items-center gap-3"},yt={class:"grid grid-cols-1 gap-6 md:grid-cols-2 lg:grid-cols-5"},kt={class:"p-4"},ht={class:"mt-2 text-lg font-semibold text-secondary-900"},_t={class:"p-4"},bt={class:"mt-2 text-lg font-semibold text-secondary-900"},jt={class:"p-4"},wt={class:"mt-2 text-lg font-semibold text-secondary-900"},Tt={class:"p-4"},Dt={class:"mt-2 text-lg font-semibold text-secondary-900"},Ht={class:"p-4"},Ct={class:"mt-2 text-lg font-semibold text-secondary-900"},St={class:"space-y-4"},Pt={class:"grid grid-cols-2 gap-4 text-sm"},Bt={class:"font-medium text-secondary-900"},Mt={class:"font-medium text-secondary-900"},It={class:"grid grid-cols-1 gap-4 sm:grid-cols-2 lg:grid-cols-3"},Vt=["src","alt"],$t={class:"font-medium text-secondary-900"},Et={class:"text-sm text-secondary-600"},zt={class:"flex flex-wrap gap-2"},Nt={class:"grid grid-cols-1 gap-4 sm:grid-cols-2 lg:grid-cols-3"},Lt=["disabled"],Ot={class:"text-sm text-secondary-600"},Rt=["disabled"],Yt={class:"text-center"},oe=et({__name:"ProjectDetail",setup(Ft){const k=nt(),x=rt(),f=st(),C=ut(),N=ot(),d=j(k.params.id),h=j(!1),_=j(!1);at(()=>{if(k.params.id){d.value=k.params.id;const s=f.projectById(d.value);if(s&&(f.setCurrentProject(s),!s.estimatedHours||s.estimatedHours===0)){const e=Y();e>0&&f.updateProject(d.value,{estimatedHours:e})}}C.loadTasks(d.value)});const o=y(()=>f.projectById(d.value)),c=y(()=>C.tasksByProject(d.value)),S=y(()=>o.value?N.getUsersByIds(o.value.memberIds):[]),L=y(()=>{var a;if((a=o.value)!=null&&a.estimatedHours&&o.value.estimatedHours>0)return o.value.estimatedHours;const s=c.value;return s.length===0?0:s.filter(n=>!n.parentTaskId).reduce((n,p)=>n+(p.estimatedHours||0),0)});V(o,async s=>{if(s&&(!s.estimatedHours||s.estimatedHours===0)){const e=c.value;if(e.length>0){const a=e.filter(n=>!n.parentTaskId).reduce((n,p)=>n+(p.estimatedHours||0),0);a>0&&await f.updateProject(d.value,{estimatedHours:a})}}});const O=()=>{const s=c.value;if(s.length===0)return 0;const e=s.filter(a=>!s.some(n=>n.parentTaskId===a.id));if(e.length===0)return 0;const r=e.filter(a=>a.status==="done").length;return Math.round(r/e.length*100)},R=()=>{var r;if(((r=o.value)==null?void 0:r.status)==="on-hold")return"on-hold";const s=c.value;if(s.length===0)return"planning";const e=s.map(a=>a.status);return e.every(a=>a==="done")?"completed":e.some(a=>a==="in-progress")?"active":e.every(a=>a==="todo")?"planning":"active"},Y=()=>{const s=c.value;return s.length===0?0:s.filter(a=>!a.parentTaskId).reduce((a,n)=>a+(n.estimatedHours||0),0)};V(c,async()=>{if(!o.value)return;const s={},e=O();if(e!==o.value.progress&&(s.progress=e),o.value.status!=="on-hold"&&o.value.status!=="cancelled"){const n=R();n!==o.value.status&&(s.status=n)}if(c.value.length>0){const n=c.value.map(b=>new Date(b.startDate).getTime()),p=c.value.map(b=>new Date(b.endDate).getTime()),Z=new Date(Math.min(...n)),tt=new Date(Math.max(...p)),M=Z.toISOString().split("T")[0],I=tt.toISOString().split("T")[0];M!==o.value.startDate&&(s.startDate=M),I!==o.value.endDate&&(s.endDate=I)}const a=c.value.filter(n=>!n.parentTaskId).reduce((n,p)=>n+(p.estimatedHours||0),0);a!==o.value.estimatedHours&&(s.estimatedHours=a),Object.keys(s).length>0&&await f.updateProject(d.value,s)},{deep:!0});const P=s=>ct(s).format("YYYY年MM月DD日"),F=s=>({planning:"计划中",active:"进行中",completed:"已完成","on-hold":"已暂停",cancelled:"废弃"})[s]||s,G=s=>({low:"低",medium:"中",high:"高",critical:"紧急"})[s]||s,U=s=>{const e=s==null?void 0:s.replace(/_/g,"-");return{admin:"管理员","project-manager":"项目经理",member:"成员"}[e]||s},B=()=>{x.push("/projects")},q=()=>{x.push(`/projects/${d.value}/tasks`)},A=()=>{x.push(`/projects/${d.value}/gantt`)},J=()=>{x.push(`/projects/${d.value}/tasks`)},K=()=>{_.value=!0,h.value=!0},Q=()=>{h.value=!1,_.value=!1},W=async s=>{_.value&&await f.updateProject(d.value,s)},X=()=>{confirm("确定要删除这个项目吗？")&&(f.deleteProject(d.value),x.push("/projects"))};return(s,e)=>(v(),w(lt,null,{default:l(()=>[t("div",pt,[o.value?(v(),g("div",mt,[t("div",vt,[t("button",{onClick:B,class:"rounded-lg p-2 hover:bg-secondary-100"},[...e[0]||(e[0]=[t("svg",{class:"h-5 w-5 text-secondary-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 19l-7-7 7-7"})],-1)])]),t("div",null,[t("h1",ft,i(o.value.name),1),t("p",gt,i(o.value.description),1)])]),t("div",xt,[u(H,{variant:"secondary",onClick:K},{default:l(()=>[...e[1]||(e[1]=[T("编辑",-1)])]),_:1}),u(H,{variant:"danger",onClick:X},{default:l(()=>[...e[2]||(e[2]=[T("删除",-1)])]),_:1})])])):$("",!0),o.value?(v(),g(D,{key:1},[t("div",yt,[u(m,null,{default:l(()=>[t("div",kt,[e[3]||(e[3]=t("p",{class:"text-sm font-medium text-secondary-600"},"状态",-1)),t("p",ht,i(F(o.value.status)),1)])]),_:1}),u(m,null,{default:l(()=>[t("div",_t,[e[4]||(e[4]=t("p",{class:"text-sm font-medium text-secondary-600"},"优先级",-1)),t("p",bt,i(G(o.value.priority)),1)])]),_:1}),u(m,null,{default:l(()=>[t("div",jt,[e[5]||(e[5]=t("p",{class:"text-sm font-medium text-secondary-600"},"进度",-1)),t("p",wt,i(o.value.progress)+"%",1)])]),_:1}),u(m,null,{default:l(()=>[t("div",Tt,[e[6]||(e[6]=t("p",{class:"text-sm font-medium text-secondary-600"},"预估工时",-1)),t("p",Dt,i(L.value)+" 小时",1)])]),_:1}),u(m,null,{default:l(()=>[t("div",Ht,[e[7]||(e[7]=t("p",{class:"text-sm font-medium text-secondary-600"},"团队成员",-1)),t("p",Ct,i(S.value.length)+" 人",1)])]),_:1})]),u(m,null,{header:l(()=>[...e[8]||(e[8]=[t("h3",{class:"text-lg font-semibold text-secondary-900"},"项目进度",-1)])]),default:l(()=>[t("div",St,[u(dt,{value:o.value.progress,"show-label":!0},null,8,["value"]),t("div",Pt,[t("div",null,[e[9]||(e[9]=t("span",{class:"text-secondary-600"},"开始日期：",-1)),t("span",Bt,i(P(o.value.startDate)),1)]),t("div",null,[e[10]||(e[10]=t("span",{class:"text-secondary-600"},"结束日期：",-1)),t("span",Mt,i(P(o.value.endDate)),1)])])])]),_:1}),u(m,null,{header:l(()=>[...e[11]||(e[11]=[t("h3",{class:"text-lg font-semibold text-secondary-900"},"团队成员",-1)])]),default:l(()=>[t("div",It,[(v(!0),g(D,null,E(S.value,r=>(v(),g("div",{key:r.id,class:"flex items-center gap-3 rounded-lg border border-secondary-200 p-3"},[t("img",{src:r.avatar,alt:r.name,class:"h-10 w-10 rounded-full"},null,8,Vt),t("div",null,[t("p",$t,i(r.name),1),t("p",Et,i(U(r.role)),1)])]))),128))])]),_:1}),o.value.tags&&o.value.tags.length>0?(v(),w(m,{key:0},{header:l(()=>[...e[12]||(e[12]=[t("h3",{class:"text-lg font-semibold text-secondary-900"},"标签",-1)])]),default:l(()=>[t("div",zt,[(v(!0),g(D,null,E(o.value.tags,r=>(v(),g("span",{key:r,class:"rounded-full bg-secondary-100 px-3 py-1 text-sm text-secondary-700"}," #"+i(r),1))),128))])]),_:1})):$("",!0),u(m,null,{header:l(()=>[...e[13]||(e[13]=[t("h3",{class:"text-lg font-semibold text-secondary-900"},"快速操作",-1)])]),default:l(()=>{var r,a,n,p;return[t("div",Nt,[t("button",{onClick:q,disabled:((r=o.value)==null?void 0:r.status)==="on-hold",class:z(["flex items-center gap-3 rounded-lg border border-secondary-200 p-4 text-left transition-colors",((a=o.value)==null?void 0:a.status)==="on-hold"?"opacity-50 cursor-not-allowed":"hover:bg-secondary-50"])},[e[15]||(e[15]=t("div",{class:"rounded-lg bg-primary-100 p-2"},[t("svg",{class:"h-6 w-6 text-primary-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"})])],-1)),t("div",null,[e[14]||(e[14]=t("p",{class:"font-medium text-secondary-900"},"查看任务",-1)),t("p",Ot,i(c.value.length)+" 个任务",1)])],10,Lt),t("button",{onClick:A,class:"flex items-center gap-3 rounded-lg border border-secondary-200 p-4 text-left transition-colors hover:bg-secondary-50"},[...e[16]||(e[16]=[t("div",{class:"rounded-lg bg-accent-100 p-2"},[t("svg",{class:"h-6 w-6 text-accent-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"})])],-1),t("div",null,[t("p",{class:"font-medium text-secondary-900"},"甘特图"),t("p",{class:"text-sm text-secondary-600"},"时间线视图")],-1)])]),t("button",{onClick:J,disabled:((n=o.value)==null?void 0:n.status)==="on-hold",class:z(["flex items-center gap-3 rounded-lg border border-secondary-200 p-4 text-left transition-colors",((p=o.value)==null?void 0:p.status)==="on-hold"?"opacity-50 cursor-not-allowed":"hover:bg-secondary-50"])},[...e[17]||(e[17]=[t("div",{class:"rounded-lg bg-info-100 p-2"},[t("svg",{class:"h-6 w-6 text-info-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})])],-1),t("div",null,[t("p",{class:"font-medium text-secondary-900"},"新建任务"),t("p",{class:"text-sm text-secondary-600"},"添加新任务")],-1)])],10,Rt)])]}),_:1})],64)):(v(),w(m,{key:2,class:"p-12"},{default:l(()=>[t("div",Yt,[e[19]||(e[19]=t("svg",{class:"mx-auto h-24 w-24 text-secondary-300",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"1",d:"M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z"})],-1)),e[20]||(e[20]=t("h3",{class:"mt-4 text-lg font-medium text-secondary-900"},"项目不存在",-1)),e[21]||(e[21]=t("p",{class:"mt-2 text-sm text-secondary-600"},"请检查项目ID是否正确",-1)),u(H,{variant:"primary",class:"mt-4",onClick:B},{default:l(()=>[...e[18]||(e[18]=[T("返回项目列表",-1)])]),_:1})])]),_:1})),u(it,{open:h.value,project:o.value,onClose:Q,onSave:W},null,8,["open","project"])])]),_:1}))}});export{oe as default};

import{d as W,u as G,o as J,y as P,z as n,p as w,r as b,j as d,b as t,B as i,i as h,t as r,c,C as I,F as j,n as K,f as g,v as C,bJ as Q,w as X,H as Z}from"./index-BeQ_YpYi.js";import{i as ee,L as te}from"./index-Bn9PLWWT.js";import{_ as se}from"./MainLayout.vue_vue_type_script_setup_true_lang-BCk_IIN5.js";import{_ as u}from"./Card.vue_vue_type_script_setup_true_lang-pWITqjj4.js";import{_ as U}from"./Button.vue_vue_type_script_setup_true_lang-BNsZ58pO.js";import{_ as ae}from"./Badge.vue_vue_type_script_setup_true_lang-CCLVA0ec.js";import{M as oe}from"./Modal-DQYTPExH.js";import{u as le}from"./task-pjRFF-OE.js";import{d as ne}from"./dayjs.min-Do37gnd9.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./_commonjsHelpers-C4iS2aBk.js";const re={class:"space-y-6"},ie={class:"flex items-center justify-between"},de={class:"grid grid-cols-1 gap-6 sm:grid-cols-2 lg:grid-cols-4"},me={class:"p-4"},ce={class:"mt-2 text-2xl font-semibold text-secondary-900"},pe={class:"p-4"},ue={class:"mt-2 text-2xl font-semibold text-secondary-900"},xe={class:"p-4"},fe={class:"mt-2 text-2xl font-semibold text-secondary-900"},ye={class:"p-4"},ve={class:"mt-2 text-2xl font-semibold text-secondary-900"},be={class:"overflow-x-auto"},ge={class:"min-w-full divide-y divide-secondary-200"},ke={class:"divide-y divide-secondary-200 bg-white"},_e={class:"whitespace-nowrap px-6 py-4"},we={class:"flex items-center"},he=["src","alt"],Ce={class:"ml-4"},Me={class:"text-sm font-medium text-secondary-900"},Se={class:"text-sm text-secondary-600"},Te={class:"whitespace-nowrap px-6 py-4"},je={class:"whitespace-nowrap px-6 py-4 text-sm text-secondary-900"},Ue={class:"px-6 py-4"},Ve={class:"flex flex-wrap gap-1"},Ae={key:0,class:"rounded bg-secondary-100 px-2 py-0.5 text-xs text-secondary-600"},Ie={key:1,class:"text-xs text-secondary-400"},Re={class:"whitespace-nowrap px-6 py-4 text-sm text-secondary-600"},$e={class:"whitespace-nowrap px-6 py-4 text-sm"},Be=["onClick"],De=["onClick"],Le={class:"flex justify-end gap-3"},Ke=W({__name:"Team",setup(Ne){const x=G(),k=le(),m=w(()=>x.users),M=b(),f=b(!1),y=b(!1),_=b(null),v=b(""),o=Z({name:"",email:"",role:"member",department:"",skills:[]}),R=()=>{o.name="",o.email="",o.role="member",o.department="",o.skills=[],v.value=""},S=()=>{f.value=!1,y.value=!1,_.value=null,R()},$=a=>{var s;y.value=!0,_.value=a.id,o.name=a.name,o.email=a.email;const e=((s=a.role)==null?void 0:s.replace(/_/g,"-"))||"member";o.role=e,o.department=a.department,o.skills=Array.isArray(a.skills)?[...a.skills]:[],v.value=Array.isArray(a.skills)?a.skills.join(", "):"",f.value=!0},V=async()=>{if(!o.name||!o.email||!o.department){alert("请填写所有必填项！");return}const a=v.value.split(",").map(e=>e.trim()).filter(e=>e.length>0);try{if(y.value&&_.value)await x.updateUser(_.value,{name:o.name,email:o.email,role:o.role,department:o.department,skills:a}),alert("成员信息更新成功！");else{const e=`https://api.dicebear.com/7.x/avataaars/svg?seed=${encodeURIComponent(o.name)}`;await x.addUser({...o,skills:a,avatar:e,joinedAt:new Date().toISOString()}),alert("新成员添加成功！")}S(),setTimeout(()=>{T()},200)}catch(e){console.error("Failed to save member:",e),alert("操作失败，请稍后重试。")}},B=async a=>{const e=m.value.find(s=>s.id===a);if(e&&confirm(`确定要删除成员 "${e.name}" 吗？此操作不可恢复。`))try{await x.deleteUser(a),alert("成员删除成功！"),setTimeout(()=>{T()},200)}catch(s){console.error("Failed to delete member:",s),alert("删除失败，请稍后重试。")}},D=w(()=>m.value.filter(a=>{var e;return((e=a.role)==null?void 0:e.replace(/_/g,"-"))==="admin"}).length),L=w(()=>m.value.filter(a=>{var e;return((e=a.role)==null?void 0:e.replace(/_/g,"-"))==="project-manager"}).length),N=w(()=>m.value.filter(a=>{var e;return((e=a.role)==null?void 0:e.replace(/_/g,"-"))==="member"}).length),z=a=>{const e=a==null?void 0:a.replace(/_/g,"-");return{admin:"管理员","project-manager":"项目经理",member:"成员"}[e]||a},q=a=>{const e=a==null?void 0:a.replace(/_/g,"-");return{admin:"danger","project-manager":"warning",member:"primary"}[e]||"default"},F=a=>ne(a).format("YYYY年MM月"),T=()=>{if(!M.value)return;const a=ee(M.value),e=new Set(k.tasks.map(l=>l.id)),s=new Set(k.tasks.filter(l=>l.parentTaskId).map(l=>l.parentTaskId)),p=new Set([...e].filter(l=>!s.has(l))),Y=k.tasks.filter(l=>p.has(l.id)),A=m.value.slice(0,8).map(l=>{const H=Y.filter(O=>O.assigneeId===l.id).length;return{name:l.name,value:H}}),E={tooltip:{trigger:"axis",axisPointer:{type:"shadow"}},grid:{left:"3%",right:"4%",bottom:"3%",containLabel:!0},xAxis:{type:"category",data:A.map(l=>l.name),axisLabel:{interval:0,rotate:30}},yAxis:{type:"value",name:"任务数"},series:[{name:"任务数",type:"bar",data:A.map(l=>l.value),itemStyle:{color:new te(0,0,0,1,[{offset:0,color:"#3b82f6"},{offset:1,color:"#1d4ed8"}]),borderRadius:[4,4,0,0]},barWidth:"60%"}]};a.setOption(E)};return J(async()=>{await x.loadUsers();try{await k.loadTasks()}catch(a){console.warn("加载任务数据失败:",a)}setTimeout(()=>{T()},100)}),(a,e)=>(d(),P(se,null,{default:n(()=>[t("div",re,[t("div",ie,[e[8]||(e[8]=t("div",null,[t("h1",{class:"text-2xl font-bold text-secondary-900"},"团队成员"),t("p",{class:"mt-1 text-sm text-secondary-600"},"管理项目团队成员和权限")],-1)),i(U,{variant:"primary",onClick:e[0]||(e[0]=s=>f.value=!0)},{default:n(()=>[...e[7]||(e[7]=[t("svg",{class:"mr-2 h-5 w-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})],-1),h(" 添加成员 ",-1)])]),_:1})]),t("div",de,[i(u,null,{default:n(()=>[t("div",me,[e[9]||(e[9]=t("p",{class:"text-sm font-medium text-secondary-600"},"总成员数",-1)),t("p",ce,r(m.value.length),1)])]),_:1}),i(u,null,{default:n(()=>[t("div",pe,[e[10]||(e[10]=t("p",{class:"text-sm font-medium text-secondary-600"},"管理员",-1)),t("p",ue,r(D.value),1)])]),_:1}),i(u,null,{default:n(()=>[t("div",xe,[e[11]||(e[11]=t("p",{class:"text-sm font-medium text-secondary-600"},"项目经理",-1)),t("p",fe,r(L.value),1)])]),_:1}),i(u,null,{default:n(()=>[t("div",ye,[e[12]||(e[12]=t("p",{class:"text-sm font-medium text-secondary-600"},"成员",-1)),t("p",ve,r(N.value),1)])]),_:1})]),i(u,null,{header:n(()=>[...e[13]||(e[13]=[t("h3",{class:"text-lg font-semibold text-secondary-900"},"所有成员",-1)])]),default:n(()=>[t("div",be,[t("table",ge,[e[14]||(e[14]=t("thead",{class:"bg-secondary-50"},[t("tr",null,[t("th",{class:"px-6 py-3 text-left text-xs font-medium uppercase tracking-wider text-secondary-500"}," 成员 "),t("th",{class:"px-6 py-3 text-left text-xs font-medium uppercase tracking-wider text-secondary-500"}," 角色 "),t("th",{class:"px-6 py-3 text-left text-xs font-medium uppercase tracking-wider text-secondary-500"}," 部门 "),t("th",{class:"px-6 py-3 text-left text-xs font-medium uppercase tracking-wider text-secondary-500"}," 技能 "),t("th",{class:"px-6 py-3 text-left text-xs font-medium uppercase tracking-wider text-secondary-500"}," 加入时间 "),t("th",{class:"px-6 py-3 text-left text-xs font-medium uppercase tracking-wider text-secondary-500"}," 操作 ")])],-1)),t("tbody",ke,[(d(!0),c(j,null,I(m.value,s=>(d(),c("tr",{key:s.id,class:"hover:bg-secondary-50"},[t("td",_e,[t("div",we,[t("img",{src:s.avatar,alt:s.name,class:"h-10 w-10 rounded-full"},null,8,he),t("div",Ce,[t("div",Me,r(s.name),1),t("div",Se,r(s.email),1)])])]),t("td",Te,[i(ae,{variant:q(s.role)},{default:n(()=>[h(r(z(s.role)),1)]),_:2},1032,["variant"])]),t("td",je,r(s.department),1),t("td",Ue,[t("div",Ve,[s.skills&&s.skills.length>0?(d(),c(j,{key:0},[(d(!0),c(j,null,I(s.skills.slice(0,2),p=>(d(),c("span",{key:p,class:"rounded bg-secondary-100 px-2 py-0.5 text-xs text-secondary-600"},r(p),1))),128)),s.skills.length>2?(d(),c("span",Ae," +"+r(s.skills.length-2),1)):K("",!0)],64)):(d(),c("span",Ie,"-"))])]),t("td",Re,r(F(s.joinedAt)),1),t("td",$e,[t("button",{onClick:p=>$(s),class:"text-primary-600 hover:text-primary-900 mr-3"}," 编辑 ",8,Be),t("button",{onClick:p=>B(s.id),class:"text-red-600 hover:text-red-900"}," 删除 ",8,De)])]))),128))])])])]),_:1}),i(u,null,{header:n(()=>[...e[15]||(e[15]=[t("h3",{class:"text-lg font-semibold text-secondary-900"},"工作负载分布",-1)])]),default:n(()=>[t("div",{class:"h-80",ref_key:"workloadChartRef",ref:M},null,512)]),_:1})]),i(oe,{open:f.value,"onUpdate:open":e[6]||(e[6]=s=>f.value=s),title:y.value?"编辑成员":"添加新成员",size:"lg",onClose:S},{footer:n(()=>[t("div",Le,[i(U,{variant:"secondary",onClick:S},{default:n(()=>[...e[23]||(e[23]=[h("取消",-1)])]),_:1}),i(U,{variant:"primary",onClick:V},{default:n(()=>[h(r(y.value?"保存修改":"添加成员"),1)]),_:1})])]),default:n(()=>[t("form",{onSubmit:X(V,["prevent"]),class:"space-y-4"},[t("div",null,[e[16]||(e[16]=t("label",{class:"block text-sm font-medium text-secondary-700 mb-1"},"姓名 *",-1)),g(t("input",{"onUpdate:modelValue":e[1]||(e[1]=s=>o.name=s),type:"text",required:"",class:"w-full rounded-lg border border-secondary-300 px-3 py-2 text-sm focus:border-primary-500 focus:outline-none focus:ring-1 focus:ring-primary-500",placeholder:"请输入成员姓名"},null,512),[[C,o.name]])]),t("div",null,[e[17]||(e[17]=t("label",{class:"block text-sm font-medium text-secondary-700 mb-1"},"邮箱 *",-1)),g(t("input",{"onUpdate:modelValue":e[2]||(e[2]=s=>o.email=s),type:"email",required:"",class:"w-full rounded-lg border border-secondary-300 px-3 py-2 text-sm focus:border-primary-500 focus:outline-none focus:ring-1 focus:ring-primary-500",placeholder:"example@company.com"},null,512),[[C,o.email]])]),t("div",null,[e[19]||(e[19]=t("label",{class:"block text-sm font-medium text-secondary-700 mb-1"},"角色 *",-1)),g(t("select",{"onUpdate:modelValue":e[3]||(e[3]=s=>o.role=s),required:"",class:"w-full rounded-lg border border-secondary-300 px-3 py-2 text-sm focus:border-primary-500 focus:outline-none focus:ring-1 focus:ring-primary-500"},[...e[18]||(e[18]=[t("option",{value:""},"请选择角色",-1),t("option",{value:"member"},"成员",-1),t("option",{value:"project-manager"},"项目经理",-1),t("option",{value:"admin"},"管理员",-1)])],512),[[Q,o.role]])]),t("div",null,[e[20]||(e[20]=t("label",{class:"block text-sm font-medium text-secondary-700 mb-1"},"部门 *",-1)),g(t("input",{"onUpdate:modelValue":e[4]||(e[4]=s=>o.department=s),type:"text",required:"",class:"w-full rounded-lg border border-secondary-300 px-3 py-2 text-sm focus:border-primary-500 focus:outline-none focus:ring-1 focus:ring-primary-500",placeholder:"例如：研发部"},null,512),[[C,o.department]])]),t("div",null,[e[21]||(e[21]=t("label",{class:"block text-sm font-medium text-secondary-700 mb-1"},"技能",-1)),g(t("input",{"onUpdate:modelValue":e[5]||(e[5]=s=>v.value=s),type:"text",class:"w-full rounded-lg border border-secondary-300 px-3 py-2 text-sm focus:border-primary-500 focus:outline-none focus:ring-1 focus:ring-primary-500",placeholder:"用逗号分隔，例如：Vue, TypeScript, Node.js"},null,512),[[C,v.value]]),e[22]||(e[22]=t("p",{class:"mt-1 text-xs text-secondary-500"},"多个技能请用逗号分隔",-1))])],32)]),_:1},8,["open","title"])]),_:1}))}});export{Ke as default};

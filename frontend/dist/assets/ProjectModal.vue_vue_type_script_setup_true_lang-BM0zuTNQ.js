import{d as h,u as A,m as L,x as V,j as n,y as W,z as u,b as o,w as G,B as m,f as p,v as b,i as c,c as l,n as y,E as v,t as f,C as g,F as D,h as J,D as K,p as q,r as Q,H as T}from"./index-BeQ_YpYi.js";import{M as R}from"./Modal-DQYTPExH.js";import{_ as z}from"./Button.vue_vue_type_script_setup_true_lang-BNsZ58pO.js";import{_ as X}from"./Input.vue_vue_type_script_setup_true_lang-xq1Wb3QM.js";import{_ as C}from"./Select.vue_vue_type_script_setup_true_lang-D-AOEX65.js";const Y={class:"grid grid-cols-2 gap-4"},Z={class:"grid grid-cols-2 gap-4"},ee={class:"mb-1 block text-sm font-medium text-secondary-700"},te={key:0,class:"text-xs text-secondary-500 font-normal ml-2"},oe=["disabled"],se={class:"mb-1 block text-sm font-medium text-secondary-700"},re={key:0,class:"text-xs text-secondary-500 font-normal ml-2"},ae=["disabled"],ne={key:0,class:"rounded-lg bg-info-50 border border-info-200 p-3"},le={class:"mb-1 block text-sm font-medium text-secondary-700"},de={key:0,class:"mt-1 text-xs text-secondary-500"},ie=["value"],ue={class:"grid grid-cols-2 gap-2 rounded-lg border border-secondary-200 p-3"},me=["value"],pe=["src","alt"],ce={class:"text-sm text-secondary-700"},fe={class:"flex gap-3"},be=["onClick"],ye={class:"flex flex-wrap gap-2"},xe=["onClick"],ve={key:1},ge={class:"mb-1 block text-sm font-medium text-secondary-700"},De={class:"flex justify-end gap-3"},_e=h({__name:"ProjectModal",props:{open:{type:Boolean},project:{}},emits:["close","save"],setup(_,{emit:$}){const r=_,I=$,E=A();L();const H=q(()=>E.users),a=q(()=>!!r.project),w=Q(!1),F=["前端","后端","全栈","移动端","设计","数据库","API","DevOps","测试"],N=["#3b82f6","#10b981","#8b5cf6","#f59e0b","#06b6d4","#ec4899","#64748b","#ef4444"],e=T({name:"",description:"",status:"planning",priority:"medium",startDate:"",endDate:"",ownerId:"",memberIds:[],color:"#3b82f6",tags:[],progress:0,estimatedHours:0}),x=T({name:""}),U=()=>{e.name="",e.description="",e.status="planning",e.priority="medium",e.startDate=new Date().toISOString().split("T")[0],e.endDate="",e.ownerId="",e.memberIds=[],e.color="#3b82f6",e.tags=[],e.progress=0,e.estimatedHours=0,x.name=""},S=()=>{r.project?(e.name=r.project.name,e.description=r.project.description,e.status=r.project.status,e.priority=r.project.priority,e.startDate=r.project.startDate,e.endDate=r.project.endDate,e.ownerId=r.project.ownerId,e.memberIds=[...r.project.memberIds||[]],e.color=r.project.color||"#3b82f6",e.tags=[...r.project.tags||[]],e.progress=r.project.progress,e.estimatedHours=r.project.estimatedHours||k()):U()},O=d=>{const t=e.tags.indexOf(d);t===-1?e.tags.push(d):e.tags.splice(t,1)},k=()=>{if(!e.startDate||!e.endDate)return 0;const d=new Date(e.startDate),t=new Date(e.endDate);if(t<d)return 0;let s=0,i=new Date(d);for(;i<=t;){const B=i.getDay();B!==0&&B!==6&&s++,i.setDate(i.getDate()+1)}return s*8},P=()=>(x.name="",e.name.trim()?e.startDate&&e.endDate&&new Date(e.startDate)>new Date(e.endDate)?(alert("开始日期不能晚于结束日期"),!1):e.ownerId?!0:(alert("请选择项目负责人"),!1):(x.name="请输入项目名称",!1)),M=async()=>{if(!P())return;w.value=!0;const d={...e};I("save",d),setTimeout(()=>{w.value=!1,j()},500)},j=()=>{U(),I("close")};return V(()=>r.project,S),V(()=>r.open,d=>{d&&(S(),e.startDate&&e.endDate&&(e.estimatedHours=k()))}),V([()=>e.startDate,()=>e.endDate],()=>{e.estimatedHours=k()},{immediate:!0}),(d,t)=>(n(),W(R,{open:_.open,title:a.value?"编辑项目":"新建项目",size:"lg",onClose:j},{footer:u(()=>[o("div",De,[m(z,{variant:"secondary",onClick:j},{default:u(()=>[...t[24]||(t[24]=[c("取消",-1)])]),_:1}),m(z,{variant:"primary",onClick:M,loading:w.value},{default:u(()=>[c(f(a.value?"保存":"创建"),1)]),_:1},8,["loading"])])]),default:u(()=>[o("form",{onSubmit:G(M,["prevent"]),class:"space-y-4"},[m(X,{modelValue:e.name,"onUpdate:modelValue":t[0]||(t[0]=s=>e.name=s),label:"项目名称",placeholder:"请输入项目名称",error:x.name,required:""},null,8,["modelValue","error"]),o("div",null,[t[10]||(t[10]=o("label",{class:"mb-1 block text-sm font-medium text-secondary-700"},"项目描述",-1)),p(o("textarea",{"onUpdate:modelValue":t[1]||(t[1]=s=>e.description=s),rows:"3",class:"w-full rounded-lg border border-secondary-200 px-4 py-2 focus:border-primary-500 focus:outline-none focus:ring-2 focus:ring-primary-500/20",placeholder:"请输入项目描述"},null,512),[[b,e.description]])]),o("div",Y,[m(C,{modelValue:e.status,"onUpdate:modelValue":t[2]||(t[2]=s=>e.status=s),label:"状态",required:"",disabled:!a.value},{default:u(()=>[...t[11]||(t[11]=[o("option",{value:"planning"},"计划中",-1),o("option",{value:"active"},"进行中",-1),o("option",{value:"completed"},"已完成",-1),o("option",{value:"on-hold"},"已暂停",-1),o("option",{value:"cancelled"},"废弃",-1)])]),_:1},8,["modelValue","disabled"]),m(C,{modelValue:e.priority,"onUpdate:modelValue":t[3]||(t[3]=s=>e.priority=s),label:"优先级",required:""},{default:u(()=>[...t[12]||(t[12]=[o("option",{value:"low"},"低",-1),o("option",{value:"medium"},"中",-1),o("option",{value:"high"},"高",-1),o("option",{value:"critical"},"紧急",-1)])]),_:1},8,["modelValue"])]),o("div",Z,[o("div",null,[o("label",ee,[t[13]||(t[13]=c(" 开始日期 * ",-1)),a.value?(n(),l("span",te,"(不可编辑)")):y("",!0)]),p(o("input",{"onUpdate:modelValue":t[4]||(t[4]=s=>e.startDate=s),type:"date",disabled:a.value,class:v(["w-full rounded-lg border px-4 py-2 focus:border-primary-500 focus:outline-none focus:ring-2 focus:ring-primary-500/20",a.value?"bg-secondary-50 text-secondary-600 cursor-not-allowed opacity-60 border-secondary-200":"border-secondary-200"]),required:""},null,10,oe),[[b,e.startDate]])]),o("div",null,[o("label",se,[t[14]||(t[14]=c(" 结束日期 * ",-1)),a.value?(n(),l("span",re,"(不可编辑)")):y("",!0)]),p(o("input",{"onUpdate:modelValue":t[5]||(t[5]=s=>e.endDate=s),type:"date",disabled:a.value,class:v(["w-full rounded-lg border px-4 py-2 focus:border-primary-500 focus:outline-none focus:ring-2 focus:ring-primary-500/20",a.value?"bg-secondary-50 text-secondary-600 cursor-not-allowed opacity-60 border-secondary-200":"border-secondary-200"]),required:""},null,10,ae),[[b,e.endDate]])])]),a.value?(n(),l("div",ne,[...t[15]||(t[15]=[o("div",{class:"flex gap-2"},[o("svg",{class:"h-5 w-5 text-info-600 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[o("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})]),o("div",{class:"text-sm text-info-800"}," 项目的开始日期和结束日期会根据任务的日期自动调整，无法手动编辑。如需修改项目日期，请调整相关任务的日期。 ")],-1)])])):y("",!0),o("div",null,[o("label",le,[c(" 预估工时: "+f(e.estimatedHours||0)+" 小时 ",1),t[16]||(t[16]=o("span",{class:"text-xs text-secondary-500 font-normal ml-2"},"(根据工作日自动计算)",-1))]),p(o("input",{"onUpdate:modelValue":t[6]||(t[6]=s=>e.estimatedHours=s),type:"number",class:"w-full rounded-lg border border-secondary-200 px-4 py-2 bg-secondary-50 text-secondary-600 cursor-not-allowed opacity-60",disabled:""},null,512),[[b,e.estimatedHours,void 0,{number:!0}]]),t[17]||(t[17]=o("p",{class:"mt-1 text-xs text-secondary-500"},"此字段根据项目的开始日期和结束日期自动计算工作日（每天8小时），无法手动编辑。",-1)),a.value?(n(),l("p",de,"由于项目日期会根据任务日期自动调整，预估工时也会相应更新。")):y("",!0)]),m(C,{modelValue:e.ownerId,"onUpdate:modelValue":t[7]||(t[7]=s=>e.ownerId=s),label:"项目负责人",required:""},{default:u(()=>[t[18]||(t[18]=o("option",{value:""},"请选择",-1)),(n(!0),l(D,null,g(H.value,s=>(n(),l("option",{key:s.id,value:s.id},f(s.name),9,ie))),128))]),_:1},8,["modelValue"]),o("div",null,[t[19]||(t[19]=o("label",{class:"mb-1 block text-sm font-medium text-secondary-700"},"团队成员",-1)),o("div",ue,[(n(!0),l(D,null,g(H.value,s=>(n(),l("label",{key:s.id,class:"flex items-center gap-2 rounded-lg px-3 py-2 hover:bg-secondary-50 cursor-pointer"},[p(o("input",{type:"checkbox",value:s.id,"onUpdate:modelValue":t[8]||(t[8]=i=>e.memberIds=i),class:"rounded border-secondary-300 text-primary-600 focus:ring-primary-500"},null,8,me),[[J,e.memberIds]]),o("img",{src:s.avatar,alt:s.name,class:"h-6 w-6 rounded-full"},null,8,pe),o("span",ce,f(s.name),1)]))),128))])]),o("div",null,[t[20]||(t[20]=o("label",{class:"mb-1 block text-sm font-medium text-secondary-700"},"项目颜色",-1)),o("div",fe,[(n(),l(D,null,g(N,s=>o("button",{key:s,type:"button",onClick:i=>e.color=s,class:v(["h-10 w-10 rounded-lg border-2 transition-all",e.color===s?"border-secondary-900 scale-110":"border-transparent hover:scale-105"]),style:K({backgroundColor:s})},null,14,be)),64))])]),o("div",null,[t[21]||(t[21]=o("label",{class:"mb-1 block text-sm font-medium text-secondary-700"},"标签",-1)),o("div",ye,[(n(),l(D,null,g(F,s=>o("span",{key:s,onClick:i=>O(s),class:v(["cursor-pointer rounded-full px-3 py-1 text-sm transition-colors",e.tags.includes(s)?"bg-primary-600 text-white":"bg-secondary-100 text-secondary-700 hover:bg-secondary-200"])},f(s),11,xe)),64))])]),a.value?(n(),l("div",ve,[o("label",ge,[c(" 进度: "+f(e.progress)+"% ",1),t[22]||(t[22]=o("span",{class:"text-xs text-secondary-500 font-normal ml-2"},"(根据任务完成情况自动计算)",-1))]),p(o("input",{"onUpdate:modelValue":t[9]||(t[9]=s=>e.progress=s),type:"range",min:"0",max:"100",class:"w-full opacity-60 cursor-not-allowed",disabled:""},null,512),[[b,e.progress,void 0,{number:!0}]]),t[23]||(t[23]=o("p",{class:"mt-1 text-xs text-secondary-500"},"此字段根据项目中所有任务的完成比例自动计算，无法手动编辑",-1))])):y("",!0)],32)]),_:1},8,["open","title"]))}});export{_e as _};

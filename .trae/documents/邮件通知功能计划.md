# WBS系统邮件通知功能 - 实施计划

## 概述
为WBS系统中的关键业务场景添加邮件通知功能，提高团队协作效率和信息透明度。

---

## [ ] 任务1: 邮件服务基础设施搭建
- **Priority**: P0
- **Depends On**: None
- **Description**: 
  - 创建邮件服务配置类
  - 实现邮件发送工具类
  - 配置邮件模板
- **Success Criteria**:
  - 邮件服务能够正常发送邮件
  - 邮件模板能够正确渲染
- **Test Requirements**:
  - `programmatic` TR-1.1: 验证邮件服务连接成功
  - `programmatic` TR-1.2: 验证测试邮件能够正常发送
- **Notes**: 需要在application.yml中配置SMTP服务器信息

---

## [ ] 任务2: 项目相关邮件通知
- **Priority**: P1
- **Depends On**: Task 1
- **Description**: 
  - 项目创建：通知所有项目成员
  - 项目成员添加：通知新加入的成员
  - 项目成员移除：通知被移除的成员
  - 项目状态变更：通知所有项目成员
- **Success Criteria**:
  - 相关人员能够在事件发生时收到邮件通知
  - 邮件内容包含完整的项目信息
- **Test Requirements**:
  - `programmatic` TR-2.1: 验证项目创建时发送邮件给所有成员
  - `programmatic` TR-2.2: 验证成员变更时发送邮件通知
  - `human-judgement` TR-2.3: 验证邮件内容格式正确、信息完整

---

## [ ] 任务3: 任务相关邮件通知
- **Priority**: P1
- **Depends On**: Task 1
- **Description**: 
  - 任务创建/分配：通知任务负责人
  - 任务重新分配：通知新负责人和原负责人
  - 任务状态变更：通知任务负责人和项目负责人
  - 任务延期：通知任务负责人和项目负责人
  - 任务完成：通知任务负责人和项目负责人
- **Success Criteria**:
  - 任务相关人员能够及时收到通知
  - 邮件包含任务详细信息
- **Test Requirements**:
  - `programmatic` TR-3.1: 验证任务分配时发送邮件给负责人
  - `programmatic` TR-3.2: 验证任务状态变更时发送邮件通知
  - `programmatic` TR-3.3: 验证任务延期时发送预警邮件
  - `human-judgement` TR-3.4: 验证邮件内容准确、清晰

---

## [ ] 任务4: 加班相关邮件通知
- **Priority**: P1
- **Depends On**: Task 1
- **Description**: 
  - 加班申请提交：通知项目负责人
  - 加班申请审批：通知申请人
    - 审批通过：发送批准通知
    - 审批拒绝：发送拒绝通知及原因
- **Success Criteria**:
  - 申请人和审批人都能及时收到通知
  - 审批结果邮件包含完整信息
- **Test Requirements**:
  - `programmatic` TR-4.1: 验证加班申请提交时通知项目负责人
  - `programmatic` TR-4.2: 验证审批通过/拒绝时通知申请人
  - `human-judgement` TR-4.3: 验证邮件内容包含审批原因

---

## [ ] 任务5: 邮件模板管理
- **Priority**: P2
- **Depends On**: None
- **Description**: 
  - 创建统一的邮件模板体系
  - 支持多语言（中文、韩文）
  - 模板包含品牌元素
- **Success Criteria**:
  - 所有邮件样式统一
  - 支持中英文切换
- **Test Requirements**:
  - `human-judgement` TR-5.1: 验证邮件模板美观、专业
  - `human-judgement` TR-5.2: 验证中英文切换正常

---

## [ ] 任务6: 邮件发送日志和重试机制
- **Priority**: P2
- **Depends On**: Task 1
- **Description**: 
  - 记录所有邮件发送日志
  - 实现邮件发送失败重试机制
  - 避免重复发送邮件
- **Success Criteria**:
  - 所有邮件发送都有日志记录
  - 失败的邮件能够自动重试
- **Test Requirements**:
  - `programmatic` TR-6.1: 验证邮件发送日志正常记录
  - `programmatic` TR-6.2: 验证邮件失败时自动重试

---

## 邮件通知场景汇总

### 项目通知
1. **项目创建** → 所有项目成员
2. **项目成员添加** → 新成员
3. **项目成员移除** → 被移除成员
4. **项目状态变更** → 所有项目成员

### 任务通知
1. **任务创建/分配** → 任务负责人
2. **任务重新分配** → 新负责人 + 原负责人
3. **任务状态变更** → 任务负责人 + 项目负责人
4. **任务延期** → 任务负责人 + 项目负责人
5. **任务完成** → 任务负责人 + 项目负责人

### 加班通知
1. **加班申请提交** → 项目负责人
2. **加班审批通过** → 申请人
3. **加班审批拒绝** → 申请人（含拒绝原因）

# WBS系统邮件通知功能

## 概述
已为WBS项目管理系统搭建了完整的邮件通知基础设施。

## 已完成的工作

### 1. 依赖配置
- 在 `pom.xml` 中添加了 `spring-boot-starter-mail` 和 `thymeleaf` 依赖

### 2. 邮件服务
- **EmailService.java**：邮件发送基础服务
  - `sendEmail()`: 发送HTML格式邮件（使用模板）
  - `sendSimpleEmail()`: 发送纯文本邮件

- **EmailNotificationService.java**：业务邮件通知服务
  包含以下通知方法：
  - 项目相关：
    - `notifyProjectCreated()`: 项目创建通知
    - `notifyMemberAdded()`: 成员加入项目通知
    - `notifyMemberRemoved()`: 成员移除通知
    - `notifyProjectStatusChanged()`: 项目状态变更通知
  - 任务相关：
    - `notifyTaskAssigned()`: 任务分配通知
    - `notifyTaskReassigned()`: 任务重新分配通知
    - `notifyTaskStatusChanged()`: 任务状态变更通知
    - `notifyTaskDelayed()`: 任务延期预警
    - `notifyTaskCompleted()`: 任务完成通知
  - 加班相关：
    - `notifyOvertimeSubmitted()`: 加班申请提交通知
    - `notifyOvertimeApproved()`: 加班申请通过通知
    - `notifyOvertimeRejected()`: 加班申请拒绝通知

### 3. 邮件模板
已创建的邮件模板：
- `layout.html`: 通用邮件布局模板
- `project-created.html`: 项目创建通知
- `member-added.html`: 成员加入项目通知
- `task-assigned.html`: 任务分配通知
- `task-status-changed.html`: 任务状态变更通知
- `overtime-submitted.html`: 加班申请提交通知
- `overtime-approved.html`: 加班申请通过通知
- `overtime-rejected.html`: 加班申请拒绝通知

### 4. 配置文件
在 `application.yml` 中添加了：
- 邮件SMTP配置（需要替换为实际的邮箱和密码）
- Thymeleaf模板引擎配置

## 配置说明

### 1. 邮件服务器配置
需要在 `application.yml` 中配置正确的SMTP信息：

```yaml
spring:
  mail:
    host: smtp.qq.com        # 或其他SMTP服务器
    port: 587
    username: your-email@qq.com  # 替换为实际邮箱
    password: your-email-password # 替换为实际授权码
    display-name: WBS项目管理系统
```

### 2. 用户邮箱
确保 `User` 实体中的 `email` 字段有值，否则无法发送邮件。

## 使用方式

在需要发送邮件的Service中注入 `EmailNotificationService` 并调用相应方法：

```java
@Service
@RequiredArgsConstructor
public class YourService {
    private final EmailNotificationService emailNotificationService;
    
    public void someMethod() {
        // 示例：发送任务分配通知
        emailNotificationService.notifyTaskAssigned(task, assignee);
    }
}
```

## 下一步工作

1. 在各个Service（ProjectService、TaskService、OvertimeService）中集成邮件通知调用
2. 创建剩余的邮件模板
3. 添加邮件发送日志和重试机制
4. 测试邮件发送功能

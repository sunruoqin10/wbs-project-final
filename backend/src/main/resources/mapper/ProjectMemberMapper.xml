<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.wbs.project.mapper.ProjectMemberMapper">

    <!-- 根据项目ID查询成员ID列表 -->
    <select id="selectMemberIdsByProjectId" resultType="java.lang.String">
        SELECT user_id
        FROM sys_project_member
        WHERE project_id = #{projectId}
    </select>

    <!-- 根据用户ID查询参与的项目ID列表 -->
    <select id="selectProjectIdsByUserId" resultType="java.lang.String">
        SELECT project_id
        FROM sys_project_member
        WHERE user_id = #{userId}
    </select>

    <!-- 插入项目成员关系 -->
    <insert id="insert">
        INSERT INTO sys_project_member (project_id, user_id, joined_at)
        VALUES (#{projectId}, #{userId}, NOW())
    </insert>

    <!-- 根据项目ID删除所有成员关系 -->
    <delete id="deleteByProjectId">
        DELETE FROM sys_project_member WHERE project_id = #{projectId}
    </delete>

    <!-- 删除指定的项目成员关系 -->
    <delete id="delete">
        DELETE FROM sys_project_member
        WHERE project_id = #{projectId} AND user_id = #{userId}
    </delete>

    <!-- 批量插入项目成员 -->
    <insert id="batchInsert">
        INSERT INTO sys_project_member (project_id, user_id, joined_at)
        VALUES
        <foreach collection="userIds" item="userId" separator=",">
            (#{projectId}, #{userId}, NOW())
        </foreach>
    </insert>

    <!-- 判断用户是否是项目负责人 -->
    <select id="isProjectOwner" resultType="boolean">
        SELECT COUNT(*) > 0
        FROM sys_project_member
        WHERE project_id = #{projectId} AND user_id = #{userId} AND role = 'owner'
    </select>

    <!-- 判断用户是否是项目成员 -->
    <select id="isProjectMember" resultType="boolean">
        SELECT COUNT(*) > 0
        FROM sys_project_member
        WHERE project_id = #{projectId} AND user_id = #{userId}
    </select>

</mapper>
